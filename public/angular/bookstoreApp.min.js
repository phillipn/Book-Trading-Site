(function(){angular.module("bookstoreApp",["ngSanitize","ngRoute"]);function e(e){e.when("/",{templateUrl:"/home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/book/:bookid",{templateUrl:"/book/book.view.html",controller:"bookCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/profile",{templateUrl:"/auth/profile/profile.view.html",controller:"profileCtrl",controllerAs:"vm"}).when("/user/:userid",{templateUrl:"/auth/trades/trades.view.html",controller:"tradesCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"})}angular.module("bookstoreApp").config(["$routeProvider",e])})();(function(){angular.module("bookstoreApp").controller("homeCtrl",e);e.$inject=["$http","authentication","googleSearch","dbSearch"];function e(e,o,r,t){var n=this;n.genres=function(){t.forGenres().success(function(e){n.genres=e}).error(function(e){n.error=e});return false};n.currentUser=o.currentUser();n.genres();n.pageHeader={title:"Welcome Readers",strapline:"Check out our user's collections"};n.emphasize=function(e){if(e==="titleDiv"){n.genreDivHide=true;n.titleDivHide=false}else{n.titleDivHide=true;n.genreDivHide=false}};n.searchBooks=function(e){n.error="";n.userBooks="";n.googleBooks="";n.message="";r.forBooks(e).success(function(e){n.googleBooks=e}).error(function(e){console.log(e);n.error=e});return false};n.addBook=function(e){n.error="";n.userBooks="";n.googleBooks="";n.message="";t.addMyBook(e).success(function(e){n.message="Book added to your collection"}).error(function(e){n.error=e});return false};n.getUserBooks=function(e){n.error="";n.userBooks="";n.googleBooks="";n.message="";if(!n.currentUser){n.error="Please log in";return false}e=encodeURIComponent(e);t.forBooks(e).success(function(e){n.userBooks=e}).error(function(e){n.error=e});return false}}})();(function(){angular.module("bookstoreApp").controller("bookCtrl",e);e.$inject=["$anchorScroll","$location","$routeParams","authentication","dbSearch"];function e(e,o,r,t,n){var i=this;i.bookId=r.bookid;i.currentUser=t.currentUser();i.pageHeader={title:"Book Information"};i.clickLink="Click to see book preview!";i.ownBook=false;i.toggleButton=function(e,o){i.buttonText=e;i.buttonClass=o};i.goToTop=function(){o.hash="alert1";e()};n.findBookId(i.bookId).success(function(e){if(e.tradeRequests[0]===false){i.toggleButton("You have already requested this book","btn btn-danger");i.book=e;return false}else if(e.owner.email===i.currentUser.email){i.book=e;i.ownBook=true;return false}else{i.toggleButton("Request trade!","btn btn-success");i.book=e}}).error(function(e){i.error=e});i.requestBook=function(e){i.error="";i.message="";n.requestBook(e).success(function(e){i.toggleButton("You have already requested this book","btn btn-danger");i.message="Trade request has been sent to "+e.owner.name}).error(function(e){console.log(e);i.error=e});return false}}})();(function(){angular.module("bookstoreApp").controller("loginCtrl",e);e.$inject=["$location","authentication"];function e(e,o){var r=this;r.pageHeader={title:"Sign in to Nick's Bookstore"};r.credentials={email:"",password:""};r.returnPage=e.search().page||"/";r.onSubmit=function(){r.formError="";if(!r.credentials.email||!r.credentials.password){r.formError="All fields required, please try again";return false}else{r.doLogin()}};r.doLogin=function(){r.formError="";o.login(r.credentials).error(function(e){r.formError=e}).then(function(){if(r.returnPage=="/login"){e.path("/")}else{e.path(r.returnPage)}})}}})();(function(){angular.module("bookstoreApp").controller("registerCtrl",e);e.$inject=["$location","authentication"];function e(e,o){var r=this;r.pageHeader={title:"Create a new Bookstore account"};r.credentials={name:"",email:"",city:"",state:"",password:""};r.returnPage=e.search().page||"/";r.onSubmit=function(){r.formError="";if(!r.credentials.name||!r.credentials.email||!r.credentials.password||!r.credentials.city||!r.credentials.state){r.formError="All fields required, please try again";return false}else{r.doRegister()}};r.doRegister=function(){r.formError="";o.register(r.credentials).error(function(e){r.formError=e}).then(function(){if(r.returnPage=="/login"){e.path("/")}else{e.path(r.returnPage)}})}}})();(function(){angular.module("bookstoreApp").controller("profileCtrl",e);e.$inject=["authentication"];function e(e){var o=this;o.currentUser=e.currentUser();o.pageHeader={title:o.currentUser.name+",",strapline:"Feel free to change your information below..."};o.credentials={password:"",newPassword:""};o.location={city:"",state:""};o.changePassword=function(){o.credentials.email=o.currentUser.email;o.message="";o.error="";e.changePassword(o.credentials).success(function(e){o.message="Password Changed"}).error(function(e){o.error=e.message});return false};o.changeAddress=function(){o.location.email=o.currentUser.email;o.message="";o.error="";e.changeLocation(o.location).success(function(e){o.message="Location Changed"}).error(function(e){o.error=e.message});return false}}})();(function(){angular.module("bookstoreApp").controller("tradesCtrl",e);e.$inject=["authentication","dbSearch"];function e(e,o){var r=this;r.pageHeader={title:"Trade Central"};r.currentUser=e.currentUser();r.toggleRequestDivs=function(e){if(e=="inbox"){r.requestOutbox=false;r.requestInbox=true}else{r.requestOutbox=true;r.requestInbox=false}};r.checkApproval=function(e){return e.approval==="pending"};r.getUserBooks=function(){o.findUserBooks(r.currentUser.email).success(function(e){r.userBooks=e}).error(function(e){r.error=e})};r.getBooksByRequester=function(){o.getBooksByRequester(r.currentUser.email).success(function(e){console.log(e);r.requestedBooks=e}).error(function(e){r.error=e})};r.colorApproval=function(e){if(e=="pending"){return""}else if(e=="approved"){return"colorGreen"}else{return"colorRed"}};r.orderByApproval=function(e){if(e.approval==="pending"){return 0}else if(e.approval==="approved"){return 2}else{return 1}};r.updateRequest=function(e,t,n,i){o.updateRequest(e,t,n).success(function(e){r.userBooks[i]=e}).error(function(e){r.error=e})};r.getUserBooks();r.getBooksByRequester()}})();(function(){angular.module("bookstoreApp").service("authentication",e);e.$inject=["$http","$window"];function e(e,o){var r=function(e){o.localStorage["bookstore_token"]=e};var t=function(){return o.localStorage["bookstore_token"]};var n=function(){var e=t();if(e){var r=JSON.parse(o.atob(e.split(".")[1]));return r.exp>Date.now()/1e3}else{return false}};var i=function(){if(n()){var e=t();var r=JSON.parse(o.atob(e.split(".")[1]));return{_id:r._id,email:r.email,name:r.name,city:r.city,state:r.state}}};register=function(o){return e.post("/api/register",o).success(function(e){r(e.token)})};login=function(o){return e.post("/api/login",o).success(function(e){r(e.token)})};changePassword=function(o){return e.post("/api/changePassword",o)};changeLocation=function(o){return e.post("/api/changeLocation",o)};logout=function(){o.localStorage.removeItem("bookstore_token")};return{currentUser:i,saveToken:r,getToken:t,isLoggedIn:n,register:register,login:login,logout:logout,changePassword:changePassword,changeLocation:changeLocation}}})();(function(){angular.module("bookstoreApp").service("googleSearch",e);e.$inject=["$http"];function e(e){var o=function(o){return e.get("/api/google/books?book="+o)};return{forBooks:o}}})();(function(){angular.module("bookstoreApp").service("dbSearch",e);e.$inject=["$http","authentication"];function e(e,o){var r=function(){return e.get("/api/genres")};var t=function(r){return e.post("/api/books",r,{headers:{Authorization:"Bearer "+o.getToken()}})};var n=function(r){return e.get("/api/books/"+r,{headers:{Authorization:"Bearer "+o.getToken()}})};var i=function(o){return e.get("/api/books/?useremail="+o)};var a=function(r){return e.post("/api/books/"+r,{},{headers:{Authorization:"Bearer "+o.getToken()}})};var s=function(o){return e.get("/api/books?genre="+o)};var u=function(o,r,t){return e.put("/api/books/"+o+"/requests/"+r,t)};var l=function(o){return e.get("/api/books/?requesterEmail="+o)};return{forBooks:s,forGenres:r,addMyBook:t,requestBook:a,findBookId:n,findUserBooks:i,updateRequest:u,getBooksByRequester:l}}})();(function(){angular.module("bookstoreApp").filter("formatReview",e);function e(){return function(e){if(!e){return}return"Review: "+e[0]+" out of 5 with "+e[1]+" total reviews."}}})();(function(){angular.module("bookstoreApp").filter("formatRequest",e);function e(){return function(e){if(e.approval=="pending"){return e.name+" from "+e.city+", "+e.state}else if(e.approval=="approved"){return"Send an email to "+e.email+" to coordinate trade."}else{return"Trade rejected."}}}})();(function(){angular.module("bookstoreApp").filter("formatTradeRequestHeader",e);function e(){return function(e){if(e>1||e===0){return e+" trade requests"}else{return e+" trade request"}}}})();(function(){angular.module("bookstoreApp").filter("formatTitle",e);function e(){return function(e){return"Title: "+e}}})();(function(){angular.module("bookstoreApp").filter("formatAuthor",e);function e(){return function(e){return"Author: "+e}}})();(function(){angular.module("bookstoreApp").filter("formatDescription",e);function e(){return function(e){return"Description: "+e}}})();(function(){angular.module("bookstoreApp").filter("formatOwner",e);function e(){return function(e){if(!e){return}return"Owner: "+e.name+" from "+e.city+", "+e.state}}})();(function(){angular.module("bookstoreApp").controller("navigationCtrl",e);e.$inject=["$location","authentication"];function e(e,o){var r=this;r.currentPath=e.path();r.isLoggedIn=o.isLoggedIn();r.currentUser=o.currentUser();r.logout=function(){o.logout();r.isLoggedIn=false;e.search("search",null);e.path("/login")}}})();(function(){angular.module("bookstoreApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("bookstoreApp").directive("bookRequestDiv",e);function e(){return{restrict:"EA",scope:{thisBook:"=book"},templateUrl:"/common/directives/bookRequestDiv/bookRequest.template.html",controller:"bookRequestCtrl as brvm"}}})();(function(){angular.module("bookstoreApp").controller("bookRequestCtrl",e);e.$inject=[];function e(){var e=this;e.colorApproval=function(e){if(e=="pending"){return""}else if(e=="approved"){return"colorGreen"}else{return"colorRed"}}}})();(function(){angular.module("bookstoreApp").directive("footerGeneric",e);function e(){return{templateUrl:"/common/directives/footer/footerGeneric.template.html"}}})();(function(){angular.module("bookstoreApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();