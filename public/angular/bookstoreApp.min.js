(function(){angular.module("bookstoreApp",["ngSanitize","ngRoute"]);function e(e){e.when("/",{templateUrl:"/home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/book/:bookid",{templateUrl:"/book/book.view.html",controller:"bookCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/profile",{templateUrl:"/auth/profile/profile.view.html",controller:"profileCtrl",controllerAs:"vm"}).when("/user/:userid",{templateUrl:"/auth/trades/trades.view.html",controller:"tradesCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"})}angular.module("bookstoreApp").config(["$routeProvider",e])})();(function(){angular.module("bookstoreApp").controller("homeCtrl",e);e.$inject=["$http","authentication","googleSearch","dbSearch"];function e(e,r,o,t){var n=this;n.genres=function(){t.forGenres().success(function(e){n.genres=e}).error(function(e){n.error=e});return false};n.currentUser=r.currentUser();n.genres();n.pageHeader={title:"Welcome Readers",strapline:"Check out our user's collections"};n.emphasize=function(e){if(e==="titleDiv"){n.genreDivHide=true;n.titleDivHide=false}else{n.titleDivHide=true;n.genreDivHide=false}};n.searchBooks=function(e){n.error="";n.userBooks="";n.googleBooks="";n.message="";o.forBooks(e).success(function(e){n.googleBooks=e}).error(function(e){console.log(e);n.error=e});return false};n.addBook=function(e){n.error="";n.userBooks="";n.googleBooks="";n.message="";t.addMyBook(e).success(function(e){n.message="Book added to your collection"}).error(function(e){n.error=e});return false};n.getUserBooks=function(e){n.error="";n.userBooks="";n.googleBooks="";n.message="";if(!n.currentUser){n.error="Please log in";return false}e=encodeURIComponent(e);t.forBooks(e).success(function(e){n.userBooks=e}).error(function(e){n.error=e});return false}}})();(function(){angular.module("bookstoreApp").controller("bookCtrl",e);e.$inject=["$anchorScroll","$location","$routeParams","authentication","dbSearch"];function e(e,r,o,t,n){var i=this;i.bookId=o.bookid;i.currentUser=t.currentUser();i.pageHeader={title:"Book Information"};i.clickLink="Click to see book preview!";i.ownBook=false;i.toggleButton=function(e,r){i.buttonText=e;i.buttonClass=r};i.goToTop=function(){r.hash="alert1";e()};n.findBookId(i.bookId).success(function(e){if(e.tradeRequests[0]===false){i.toggleButton("You have already requested this book","btn btn-danger");i.book=e;return false}else if(e.owner.email===i.currentUser.email){i.book=e;i.ownBook=true;return false}else{i.toggleButton("Request trade!","btn btn-success");i.book=e}}).error(function(e){i.error=e});i.requestBook=function(e){i.error="";i.message="";n.requestBook(e).success(function(e){i.toggleButton("You have already requested this book","btn btn-danger");i.message="Trade request has been sent to "+e.owner.name}).error(function(e){console.log(e);i.error=e});return false}}})();(function(){angular.module("bookstoreApp").controller("loginCtrl",e);e.$inject=["$location","authentication"];function e(e,r){var o=this;o.pageHeader={title:"Sign in to Nick's Bookstore"};o.credentials={email:"",password:""};o.returnPage=e.search().page||"/";o.onSubmit=function(){o.formError="";if(!o.credentials.email||!o.credentials.password){o.formError="All fields required, please try again";return false}else{o.doLogin()}};o.doLogin=function(){o.formError="";r.login(o.credentials).error(function(e){o.formError=e}).then(function(){if(o.returnPage=="/login"){e.path("/")}else{e.path(o.returnPage)}})}}})();(function(){angular.module("bookstoreApp").controller("registerCtrl",e);e.$inject=["$location","authentication"];function e(e,r){var o=this;o.pageHeader={title:"Create a new Bookstore account"};o.credentials={name:"",email:"",city:"",state:"",password:""};o.returnPage=e.search().page||"/";o.onSubmit=function(){o.formError="";if(!o.credentials.name||!o.credentials.email||!o.credentials.password||!o.credentials.city||!o.credentials.state){o.formError="All fields required, please try again";return false}else{o.doRegister()}};o.doRegister=function(){o.formError="";r.register(o.credentials).error(function(e){o.formError=e}).then(function(){if(o.returnPage=="/login"){e.path("/")}else{e.path(o.returnPage)}})}}})();(function(){angular.module("bookstoreApp").controller("profileCtrl",e);e.$inject=["authentication"];function e(e){var r=this;r.currentUser=e.currentUser();r.pageHeader={title:r.currentUser.name+",",strapline:"Feel free to change your information below..."};r.credentials={password:"",newPassword:""};r.location={city:"",state:""};r.changePassword=function(){r.credentials.email=r.currentUser.email;r.message="";r.error="";e.changePassword(r.credentials).success(function(e){r.message="Password Changed"}).error(function(e){r.error=e.message});return false};r.changeAddress=function(){r.location.email=r.currentUser.email;r.message="";r.error="";e.changeLocation(r.location).success(function(e){r.message="Location Changed"}).error(function(e){r.error=e.message});return false}}})();(function(){angular.module("bookstoreApp").controller("tradesCtrl",e);e.$inject=["authentication","dbSearch"];function e(e,r){var o=this;o.pageHeader={title:"Trade Central"};o.currentUser=e.currentUser();o.toggleRequestDivs=function(e){if(e=="inbox"){o.requestOutbox=false;o.requestInbox=true}else{o.requestOutbox=true;o.requestInbox=false}};o.checkApproval=function(e){return e.approval==="pending"};o.getUserBooks=function(){r.findUserBooks(o.currentUser.email).success(function(e){o.userBooks=e}).error(function(e){o.error=e})};o.getBooksByRequester=function(){r.getBooksByRequester(o.currentUser.email).success(function(e){console.log(e);o.requestedBooks=e}).error(function(e){o.error=e})};o.colorApproval=function(e){if(e=="pending"){return""}else if(e=="approved"){return"colorGreen"}else{return"colorRed"}};o.orderByApproval=function(e){if(e.approval==="pending"){return 0}else if(e.approval==="approved"){return 2}else{return 1}};o.updateRequest=function(e,t,n,i){r.updateRequest(e,t,n).success(function(e){o.userBooks[i]=e}).error(function(e){o.error=e})};o.getUserBooks();o.getBooksByRequester()}})();(function(){angular.module("bookstoreApp").service("authentication",e);e.$inject=["$http","$window"];function e(e,r){var o=function(e){r.localStorage["bookstore_token"]=e};var t=function(){return r.localStorage["bookstore_token"]};var n=function(){var e=t();if(e){var o=JSON.parse(r.atob(e.split(".")[1]));return o.exp>Date.now()/1e3}else{return false}};var i=function(){if(n()){var e=t();var o=JSON.parse(r.atob(e.split(".")[1]));return{_id:o._id,email:o.email,name:o.name,city:o.city,state:o.state}}};register=function(r){return e.post("/api/register",r).success(function(e){o(e.token)})};login=function(r){return e.post("/api/login",r).success(function(e){o(e.token)})};changePassword=function(r){return e.post("/api/changePassword",r)};changeLocation=function(r){return e.post("/api/changeLocation",r)};logout=function(){r.localStorage.removeItem("bookstore_token")};return{currentUser:i,saveToken:o,getToken:t,isLoggedIn:n,register:register,login:login,logout:logout,changePassword:changePassword,changeLocation:changeLocation}}})();(function(){angular.module("bookstoreApp").service("googleSearch",e);e.$inject=["$http"];function e(e){var r=function(r){return e.get("/api/google/books?book="+r)};return{forBooks:r}}})();(function(){angular.module("bookstoreApp").service("dbSearch",e);e.$inject=["$http","authentication"];function e(e,r){var o=function(){return e.get("/api/genres")};var t=function(o){return e.post("/api/books",o,{headers:{Authorization:"Bearer "+r.getToken()}})};var n=function(o){return e.get("/api/books/"+o,{headers:{Authorization:"Bearer "+r.getToken()}})};var i=function(r){return e.get("/api/books/?useremail="+r)};var a=function(o){return e.post("/api/books/"+o,{},{headers:{Authorization:"Bearer "+r.getToken()}})};var s=function(r){return e.get("/api/books?genre="+r)};var u=function(r,o,t){return e.put("/api/books/"+r+"/requests/"+o,t)};var c=function(r){return e.get("/api/books/requests/"+r)};return{forBooks:s,forGenres:o,addMyBook:t,requestBook:a,findBookId:n,findUserBooks:i,updateRequest:u,getBooksByRequester:c}}})();(function(){angular.module("bookstoreApp").filter("formatReview",e);function e(){return function(e){if(!e){return}return"Review: "+e[0]+" out of 5 with "+e[1]+" total reviews."}}})();(function(){angular.module("bookstoreApp").filter("formatRequest",e);function e(){return function(e){if(e.approval=="pending"){return e.name+" from "+e.city+", "+e.state}else if(e.approval=="approved"){return"Send an email to "+e.email+" to coordinate trade."}else{return"Trade rejected."}}}})();(function(){angular.module("bookstoreApp").filter("formatTradeRequestHeader",e);function e(){return function(e){if(e>1||e===0){return e+" trade requests"}else{return e+" trade request"}}}})();(function(){angular.module("bookstoreApp").filter("formatTitle",e);function e(){return function(e){return"Title: "+e}}})();(function(){angular.module("bookstoreApp").filter("formatAuthor",e);function e(){return function(e){return"Author: "+e}}})();(function(){angular.module("bookstoreApp").filter("formatDescription",e);function e(){return function(e){return"Description: "+e}}})();(function(){angular.module("bookstoreApp").filter("formatOwner",e);function e(){return function(e){if(!e){return}return"Owner: "+e.name+" from "+e.city+", "+e.state}}})();(function(){angular.module("bookstoreApp").controller("navigationCtrl",e);e.$inject=["$location","authentication"];function e(e,r){var o=this;o.currentPath=e.path();o.isLoggedIn=r.isLoggedIn();o.currentUser=r.currentUser();o.logout=function(){r.logout();o.isLoggedIn=false;e.search("search",null);e.path("/login")}}})();(function(){angular.module("bookstoreApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("bookstoreApp").directive("footerGeneric",e);function e(){return{templateUrl:"/common/directives/footer/footerGeneric.template.html"}}})();(function(){angular.module("bookstoreApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();